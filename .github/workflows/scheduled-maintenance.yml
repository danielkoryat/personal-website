name: ğŸ”§ Scheduled Maintenance

on:
  schedule:
    # Run every Sunday at 2 AM UTC
    - cron: '0 2 * * 0'
  workflow_dispatch:

jobs:
  maintenance:
    name: ğŸ§¹ System Maintenance
    runs-on: self-hosted
    
    steps:
    - name: ğŸ³ Docker System Cleanup
      run: |
        echo "ğŸ§¹ Cleaning up Docker system..."
        docker system prune -f --volumes
        docker image prune -f --all --filter "until=168h"
        echo "âœ… Docker cleanup completed"
    
    - name: ğŸ’¾ Log Rotation
      run: |
        echo "ğŸ“ Rotating logs..."
        # Add your log rotation commands here
        echo "âœ… Log rotation completed"
    
    - name: ğŸ“Š System Health Report
      run: |
        echo "ğŸ“ˆ System Health Report:"
        echo "  â€¢ Disk Usage: $(df -h / | tail -1 | awk '{print $5}')"
        echo "  â€¢ Memory Usage: $(free -h | grep '^Mem:' | awk '{print $3"/"$2}')"
        echo "  â€¢ Docker Containers: $(docker ps --format 'table {{.Names}}\t{{.Status}}')"